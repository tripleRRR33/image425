<!DOCTYPE html>
<html>
<head>
    <title>Cr√©ateur de Carte Fantasy - √âditeur de Tuiles</title>
    <style>
        :root {
            --parchment: #f4d03f;
            --ink: #463E3F;
        }

        body {
            font-family: 'Times New Roman', serif;
            background: #2c3e50;
            margin: 0;
            padding: 20px;
            color: var(--ink);
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--parchment);
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.5);
        }

        .map-container {
            position: relative;
            width: 800px;
            height: 600px;
            margin: 20px auto;
            border: 2px solid var(--ink);
            background: #87CEEB;
            display: grid;
            grid-template-columns: repeat(40, 1fr);
            grid-template-rows: repeat(30, 1fr);
            cursor: pointer;
            transform-origin: top left;
        }

        .tile {
            width: 100%;
            height: 100%;
            border: 1px solid rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s;
        }

        .controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .palette {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(60px, 1fr));
            gap: 5px;
            margin-bottom: 20px;
        }

        .palette-tile {
            width: 50px;
            height: 50px;
            border: 2px solid transparent;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .palette-tile.selected {
            border-color: #ff0000;
        }

        button {
            background: #8b4513;
            color: var(--parchment);
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            font-family: 'Times New Roman', serif;
        }

        button:hover {
            background: #6b3410;
        }

        .terrain-plains { background-color: #90EE90; }
        .terrain-forest { background-color: #228B22; }
        .terrain-mountain { background-color: #808080; }
        .terrain-water { background-color: #4169E1; }
        .terrain-desert { background-color: #F4A460; }
        .terrain-swamp { background-color: #556B2F; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Cr√©ateur de Carte Fantasy</h1>
        
        <div class="palette" id="terrainPalette">
            <div class="palette-tile terrain-plains" data-terrain="plains" title="Plaines">üåø</div>
            <div class="palette-tile terrain-forest" data-terrain="forest" title="For√™t">üå≤</div>
            <div class="palette-tile terrain-mountain" data-terrain="mountain" title="Montagne">‚õ∞Ô∏è</div>
            <div class="palette-tile terrain-water" data-terrain="water" title="Eau">üíß</div>
            <div class="palette-tile terrain-desert" data-terrain="desert" title="D√©sert">üèúÔ∏è</div>
            <div class="palette-tile terrain-swamp" data-terrain="swamp" title="Marais">üåø</div>
        </div>

        <div class="controls">
            <button onclick="clearMap()">Effacer la carte</button>
            <button onclick="saveMap()">Sauvegarder</button>
            <button onclick="loadMap()">Charger</button>
            <button onclick="toggleDrawing()">Mode dessin: OFF</button>
            <button onclick="zoomIn()">Zoomer</button>
            <button onclick="zoomOut()">D√©zoomer</button>
            <input type="file" id="fileInput" style="display: none;" accept="application/json" onchange="handleFileSelect(event)" />
        </div>

        <div class="map-container" id="mapContainer">
            <!-- La grille sera g√©n√©r√©e en JavaScript -->
        </div>
    </div>

    <script>
        let selectedTerrain = 'plains';
        let isDrawing = false;
        let isMouseDown = false;
        let zoomLevel = 1;

        // Initialiser la grille
        const mapContainer = document.getElementById('mapContainer');
        const gridSize = { width: 40, height: 30 };
        const terrainData = Array(gridSize.height).fill().map(() => Array(gridSize.width).fill('plains'));

        // Cr√©er la grille
        for (let y = 0; y < gridSize.height; y++) {
            for (let x = 0; x < gridSize.width; x++) {
                const tile = document.createElement('div');
                tile.className = 'tile terrain-plains';
                tile.dataset.x = x;
                tile.dataset.y = y;
                mapContainer.appendChild(tile);
            }
        }

        // Gestion de la palette
        document.querySelectorAll('.palette-tile').forEach(tile => {
            tile.addEventListener('click', (e) => {
                document.querySelectorAll('.palette-tile').forEach(t => t.classList.remove('selected'));
                e.target.classList.add('selected');
                selectedTerrain = e.target.dataset.terrain;
            });
        });

        // Gestion du dessin
        mapContainer.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            if (e.target.classList.contains('tile')) {
                paintTile(e.target);
            }
        });

        mapContainer.addEventListener('mousemove', (e) => {
            if (isMouseDown && isDrawing && e.target.classList.contains('tile')) {
                paintTile(e.target);
            }
        });

        document.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        function paintTile(tile) {
            saveState();
            // Retirer les classes de terrain existantes
            tile.className = 'tile';
            tile.classList.add(`terrain-${selectedTerrain}`);
            
            // Mettre √† jour les donn√©es
            const x = parseInt(tile.dataset.x);
            const y = parseInt(tile.dataset.y);
            terrainData[y][x] = selectedTerrain;
        }

        function toggleDrawing() {
            isDrawing = !isDrawing;
            const btn = document.querySelector('button:nth-child(4)');
            btn.textContent = `Mode dessin: ${isDrawing ? 'ON' : 'OFF'}`;
        }

        function clearMap() {
            document.querySelectorAll('.tile').forEach(tile => {
                tile.className = 'tile terrain-plains';
            });
            terrainData.forEach(row => row.fill('plains'));
        }

        function saveMap() {
            const mapData = {
                terrain: terrainData,
                width: gridSize.width,
                height: gridSize.height,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(mapData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'carte-fantasy.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function loadMap() {
            document.getElementById('fileInput').click();
        }

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mapData = JSON.parse(e.target.result);
                    applyMapData(mapData);
                };
                reader.readAsText(file);
            }
        }

        function applyMapData(mapData) {
            terrainData.length = 0;
            mapData.terrain.forEach(row => terrainData.push([...row]));
            updateMap();
        }

        function updateMap() {
            document.querySelectorAll('.tile').forEach(tile => {
                const x = parseInt(tile.dataset.x);
                const y = parseInt(tile.dataset.y);
                tile.className = 'tile';
                tile.classList.add(`terrain-${terrainData[y][x]}`);
            });
        }

        function zoomIn() {
            zoomLevel += 0.1;
            updateZoom();
        }

        function zoomOut() {
            zoomLevel -= 0.1;
            updateZoom();
        }

        function updateZoom() {
            mapContainer.style.transform = `scale(${zoomLevel})`;
        }

        // Initial save
        saveState();
        const history = [];
        let currentStep = -1;

        function saveState() {
            history.splice(currentStep + 1);
            history.push(JSON.stringify(terrainData));
            currentStep++;
        }

        function undo() {
            if (currentStep > 0) {
                currentStep--;
                terrainData = JSON.parse(history[currentStep]);
                updateMap();
            }
        }

        function redo() {
            if (currentStep < history.length - 1) {
                currentStep++;
                terrainData = JSON.parse(history[currentStep]);
                updateMap();
            }
        }

        document.querySelector('button:nth-child(4)').addEventListener('click', undo);
        document.querySelector('button:nth-child(5)').addEventListener('click', redo);
    </script>
</body>
</html>
