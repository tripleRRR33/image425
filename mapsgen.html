<!DOCTYPE html>
<html>
<head>
    <title>Cr√©ateur de Carte Fantasy - √âditeur de Tuiles</title>
    <style>
    /* Styles existants */

    /* Am√©liorer l'apparence des cit√©s */
    .terrain-city {
        background-color: #C0C0C0;
        border: 2px solid #000000;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        background-image: url('images/city-icon.png');
        background-size: cover;
    }
</style>

<script>
    // Code existant

    // G√©n√©rer la palette
    function generatePalette() {
        const palette = document.getElementById('terrainPalette');
        palette.innerHTML = '';
        
        Object.entries(TERRAIN_TYPES).forEach(([key, value]) => {
            const tileDiv = document.createElement('div');
            tileDiv.className = `palette-tile terrain-${key}`;
            tileDiv.dataset.terrain = key;
            tileDiv.title = value.name;
            tileDiv.innerHTML = value.emoji;
            palette.appendChild(tileDiv);
        });

        // R√©attacher les √©v√©nements de la palette
        document.querySelectorAll('.palette-tile').forEach(tile => {
            tile.addEventListener('click', (e) => {
                document.querySelectorAll('.palette-tile').forEach(t => t.classList.remove('selected'));
                e.target.classList.add('selected');
                selectedTerrain = e.target.dataset.terrain;
            });
        });
    }

    // Appeler generatePalette √† la fin du chargement du document
    document.addEventListener('DOMContentLoaded', () => {
        generatePalette();
    });

    // Gestion du dessin
    mapContainer.addEventListener('mousedown', (e) => {
        isMouseDown = true;
        if (e.target.classList.contains('tile')) {
            paintTile(e.target);
        }
    });

    mapContainer.addEventListener('mousemove', (e) => {
        if (isMouseDown && isDrawing && e.target.classList.contains('tile')) {
            paintTile(e.target);
        }
    });

    document.addEventListener('mouseup', () => {
        isMouseDown = false;
    });

    function paintTile(tile) {
        // Retirer les classes de terrain existantes
        tile.className = 'tile';
        tile.classList.add(`terrain-${selectedTerrain}`);
        
        // Mettre √† jour les donn√©es
        const x = parseInt(tile.dataset.x);
        const y = parseInt(tile.dataset.y);
        terrainData[y][x] = selectedTerrain;
    }

    function toggleDrawing() {
        isDrawing = !isDrawing;
        const btn = document.querySelector('button:last-child');
        btn.textContent = `Mode dessin: ${isDrawing ? 'ON' : 'OFF'}`;
    }

    function clearMap() {
        document.querySelectorAll('.tile').forEach(tile => {
            tile.className = 'tile terrain-plains';
        });
        terrainData.forEach(row => row.fill('plains'));
    }

    function saveMap() {
        const mapData = {
            terrain: terrainData,
            width: gridSize.width,
            height: gridSize.height,
            timestamp: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(mapData, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'carte-fantasy.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
<body>
    <div class="container">
        <h1>Cr√©ateur de Carte Fantasy</h1>
        
        <div class="palette" id="terrainPalette">
            <!-- La palette sera g√©n√©r√©e automatiquement -->
        </div>

        <div class="controls">
            <button onclick="clearMap()">Effacer la carte</button>
            <button onclick="saveMap()">Sauvegarder</button>
            <button onclick="toggleDrawing()">Mode dessin: OFF</button>
        </div>

        <div class="map-container" id="mapContainer">
            <!-- La grille sera g√©n√©r√©e en JavaScript -->
        </div>
    </div>

    <script>
        const TERRAIN_TYPES = {
            'plains': { color: '#90EE90', emoji: 'üåø', name: 'Plaines' },
            'forest': { color: '#228B22', emoji: 'üå≤', name: 'For√™t' },
            'mountain': { color: '#808080', emoji: '‚õ∞Ô∏è', name: 'Montagne' },
            'water': { color: '#4169E1', emoji: 'üíß', name: 'Eau' },
            'desert': { color: '#F4A460', emoji: 'üèúÔ∏è', name: 'D√©sert' },
            'swamp': { color: '#556B2F', emoji: 'üåø', name: 'Marais' },
            'deepWater': { color: '#000080', emoji: 'üåä', name: 'Oc√©an Profond' },
            'snowMountain': { color: '#FFFFFF', emoji: 'üèîÔ∏è', name: 'Montagne Enneig√©e' },
            'volcano': { color: '#8B0000', emoji: 'üåã', name: 'Volcan' },
            'beach': { color: '#FFD700', emoji: 'üèñÔ∏è', name: 'Plage' },
            'grassland': { color: '#98FB98', emoji: 'üåæ', name: 'Prairie' },
            'jungle': { color: '#006400', emoji: 'üå¥', name: 'Jungle' },
            'tundra': { color: '#E0FFFF', emoji: '‚ùÑÔ∏è', name: 'Toundra' },
            'hills': { color: '#DEB887', emoji: '‚õ∞Ô∏è', name: 'Collines' },
            'cave': { color: '#4A4A4A', emoji: 'üï≥Ô∏è', name: 'Grotte' },
            'marsh': { color: '#8FBC8F', emoji: 'üí®', name: 'Mar√©cage' },
            'ruins': { color: '#BC8F8F', emoji: 'üèõÔ∏è', name: 'Ruines' },
            'city': { color: '#C0C0C0', emoji: 'üè∞', name: 'Cit√©' },
            'farmland': { color: '#DAA520', emoji: 'üåæ', name: 'Terres Cultiv√©es' },
            'wasteland': { color: '#8B4513', emoji: 'üíÄ', name: 'Terres D√©sol√©es' }
        };

        let selectedTerrain = 'plains';
        let isDrawing = false;
        let isMouseDown = false;

        // Initialiser la grille
        const mapContainer = document.getElementById('mapContainer');
        const gridSize = { width: 40, height: 30 };
        let terrainData = Array(gridSize.height).fill().map(() => Array(gridSize.width).fill('plains'));

        // Cr√©er la grille
        for (let y = 0; y < gridSize.height; y++) {
            for (let x = 0; x < gridSize.width; x++) {
                const tile = document.createElement('div');
                tile.className = 'tile terrain-plains';
                tile.dataset.x = x;
                tile.dataset.y = y;
                mapContainer.appendChild(tile);
            }
        }

        // G√©n√©rer la palette
        function generatePalette() {
            const palette = document.getElementById('terrainPalette');
            palette.innerHTML = '';
            
            Object.entries(TERRAIN_TYPES).forEach(([key, value]) => {
                const tileDiv = document.createElement('div');
                tileDiv.className = `palette-tile terrain-${key}`;
                tileDiv.dataset.terrain = key;
                tileDiv.title = value.name;
                tileDiv.innerHTML = value.emoji;
                palette.appendChild(tileDiv);
            });

            // R√©attacher les √©v√©nements de la palette
            document.querySelectorAll('.palette-tile').forEach(tile => {
                tile.addEventListener('click', (e) => {
                    document.querySelectorAll('.palette-tile').forEach(t => t.classList.remove('selected'));
                    e.target.classList.add('selected');
                    selectedTerrain = e.target.dataset.terrain;
                });
            });
        }

        // Appeler generatePalette √† la fin du chargement du document
        document.addEventListener('DOMContentLoaded', () => {
            generatePalette();
        });

        // Gestion du dessin
        mapContainer.addEventListener('mousedown', (e) => {
            isMouseDown = true;
            if (e.target.classList.contains('tile')) {
                paintTile(e.target);
            }
        });

        mapContainer.addEventListener('mousemove', (e) => {
            if (isMouseDown && isDrawing && e.target.classList.contains('tile')) {
                paintTile(e.target);
            }
        });

        document.addEventListener('mouseup', () => {
            isMouseDown = false;
        });

        function paintTile(tile) {
            // Retirer les classes de terrain existantes
            tile.className = 'tile';
            tile.classList.add(`terrain-${selectedTerrain}`);
            
            // Mettre √† jour les donn√©es
            const x = parseInt(tile.dataset.x);
            const y = parseInt(tile.dataset.y);
            terrainData[y][x] = selectedTerrain;
        }

        function toggleDrawing() {
            isDrawing = !isDrawing;
            const btn = document.querySelector('button:last-child');
            btn.textContent = `Mode dessin: ${isDrawing ? 'ON' : 'OFF'}`;
        }

        function clearMap() {
            document.querySelectorAll('.tile').forEach(tile => {
                tile.className = 'tile terrain-plains';
            });
            terrainData.forEach(row => row.fill('plains'));
        }

        function saveMap() {
            const mapData = {
                terrain: terrainData,
                width: gridSize.width,
                height: gridSize.height,
                timestamp: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(mapData, null, 2)], {type: 'application/json'});
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'carte-fantasy.json';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
