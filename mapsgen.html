<!DOCTYPE html>
<html>
<head>
    <title>Créateur de Carte Fantasy - Éditeur de Tuiles</title>
  <style>
    /* Styles existants */

    /* Améliorer l'apparence des cités */
    .terrain-city {
        background-color: #C0C0C0;
        border: 2px solid #000000;
        box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.5);
        background-image: url('images/city-icon.png');
        background-size: cover;
    }
</style>

<script>
    // Code existant

    // Générer la palette
    function generatePalette() {
        const palette = document.getElementById('terrainPalette');
        palette.innerHTML = '';
        
        Object.entries(TERRAIN_TYPES).forEach(([key, value]) => {
            const tileDiv = document.createElement('div');
            tileDiv.className = `palette-tile terrain-${key}`;
            tileDiv.dataset.terrain = key;
            tileDiv.title = value.name;
            tileDiv.innerHTML = value.emoji;
            palette.appendChild(tileDiv);
        });

        // Réattacher les événements de la palette
        document.querySelectorAll('.palette-tile').forEach(tile => {
            tile.addEventListener('click', (e) => {
                document.querySelectorAll('.palette-tile').forEach(t => t.classList.remove('selected'));
                e.target.classList.add('selected');
                selectedTerrain = e.target.dataset.terrain;
            });
        });
    }

    // Appeler generatePalette à la fin du chargement du document
    document.addEventListener('DOMContentLoaded', () => {
        generatePalette();
    });

    // Gestion du dessin
    mapContainer.addEventListener('mousedown', (e) => {
        isMouseDown = true;
        if (e.target.classList.contains('tile')) {
            paintTile(e.target);
        }
    });

    mapContainer.addEventListener('mousemove', (e) => {
        if (isMouseDown && isDrawing && e.target.classList.contains('tile')) {
            paintTile(e.target);
        }
    });

    document.addEventListener('mouseup', () => {
        isMouseDown = false;
    });

    function paintTile(tile) {
        // Retirer les classes de terrain existantes
        tile.className = 'tile';
        tile.classList.add(`terrain-${selectedTerrain}`);
        
        // Mettre à jour les données
        const x = parseInt(tile.dataset.x);
        const y = parseInt(tile.dataset.y);
        terrainData[y][x] = selectedTerrain;
    }

    function toggleDrawing() {
        isDrawing = !isDrawing;
        const btn = document.querySelector('button:last-child');
        btn.textContent = `Mode dessin: ${isDrawing ? 'ON' : 'OFF'}`;
    }

    function clearMap() {
        document.querySelectorAll('.tile').forEach(tile => {
            tile.className = 'tile terrain-plains';
        });
        terrainData.forEach(row => row.fill('plains'));
    }

    function saveMap() {
        const mapData = {
            terrain: terrainData,
            width: gridSize.width,
            height: gridSize.height,
            timestamp: new Date().toISOString()
        };
        
        const blob = new Blob([JSON.stringify(mapData, null, 2)], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        
        const a = document.createElement('a');
        a.href = url;
        a.download = 'carte-fantasy.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
    }
</script>
</body>
</html>
